(function(){function a(){if(!window.history.pushState)return;f(),l(),So.comm.ajax=function(e,t,n,r){u=!0,c(!0,e,t,n,r)}}function f(){n.on("submit",function(){var e=$(this).find(".input_key"),t=$.trim(e.val());if(t=="")return location.href="/",!1;if($(this).find('input[name="adv_t"]').length>0)return!0;var n=$(".adv-search-btn");return n.length>0&&n.attr("data-val")!="all"&&n.attr("data-val","all").html("\u65f6\u95f4\uff1a \u5168\u90e8").addClass("adv-search-btn-short"),c(!0,t,$(this).serialize()),u=!1,!1}),t.delegate("#page a,#rs-top a,.mod-relation a,.so-pdr-box a","click",function(){var e=$(this).attr("href"),t=So.lib.parseQuery(e),n=t.q,r=t.pn;return u=!1,r==1?!0:(c(!0,n,e),!1)}),window.addEventListener("popstate",function(e){if(s==location.search)return;history.state&&e.state&&(So.lib.log("ajax",{type:"back"}),e.state.load==0?c(!1,e.state.q,e.state.url):location.href=e.state.url)})}function l(){var e=So.comm.q,t="/s"+location.search;history.state==null&&window.history.replaceState({q:e,url:t,load:1},e,t)}function c(e,t,n,i,u){var a=n.substring(0,3)=="/s?"?n:"/s?"+n,f={q:t,url:a,load:0};e?window.history.pushState(f,t,a):window.history.replaceState(f,t,a),document.title=t+"_360\u641c\u7d22",s=location.search,r.val(t).blur(),$("html,body").scrollTop(0),g(),n=n.replace(/^\/s\?/i,"");if(o[n])v(o[n]),typeof i=="function"&&i(u);else{var l=+(new Date);$.ajax({url:"/s",type:"get",data:n,success:function(e){l=+(new Date)-l;if(e){if(e=="ANTISPIDER")return location.href="/s?c=index&a=antispider",!1;v(e,l),typeof i=="function"&&i(u),o[n]=e}else location.href="/s?"+n},error:function(e,t,n){location.reload(!0);return;var r}})}}function h(){TIME._=+(new Date);var e=PageLine.queues.release;PageLine.queues={release:e},$.each(So.page.unload,function(e,t){t()}),So.page.unload=[],$.each(So.page.timers,function(e,t){clearInterval(t),clearTimeout(t)}),So.page.timers=[],$.each([".onebox",".dianjing",".tantan",".haosou"],function(e,t){$(window).off(t),$(document).off(t),$(document.body).off(t)}),d(),t.removeClass(),$("span.img-mj").removeClass("img-mj")}function p(){n.find('input[name="psid"]').val(So.comm.monitor.sid),$.each(So.page.reload,function(e,t){t()}),$("#container").attr("data-folding")=="1"&&(t.addClass("folding"),SouApp.unfold())}function d(){var e=["header","warper","search","footer","mohe"];$("body > div, body > p, body > ul, body > canvas").each(function(){this.id=="mohe"&&!u?$(this).remove():$.inArray(this.id,e)==-1&&$(this).remove()}),$(".js-g-remove").remove()}function v(e,n){h(),t.html(e),y(),p(),b("succ",n)}function m(e){h(),t.html(e),y(),p(),b("err")}function g(){i?i.show().find("div").addClass("loading"):i=$('<div id="resBar"><div class="loading"></div></div>').appendTo("#header")}function y(){i.fadeOut(500),setTimeout(function(){i.find("div").removeClass("loading")},480)}function b(e,t){So.lib.log("ajax",{type:e,value:t})}var e=$(window),t=$("#warper"),n=$("form.form"),r=n.find(".input_key"),i=null,s=location.search,o={},u=!1;a()})();